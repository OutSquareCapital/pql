# Sql Core API

This module contains the internal API layer. It's job is to wrap and extend the duckdb API, by providing conversions, additional features, and a fluent paradigm.
Various modules are automatically generated by the scripts and are not meant to be edited by hand.

It is not meant to be used directly by the user, but rather to be used by the public API layer.
<!-- markdownlint-disable MD060 -->
## Current duckdb typing issues

Those issues are currently present in duckdb stubs, and hence need special rules handling for code gen.
"Fixed" means that the issue is fixed by rule in `_rules.py`.

Automatizing this add too much complexity for something that takes only a few seconds to do manually, and is only needed for a few lines of code.

Any warning emitted who are NOT in the array below are considered real issues and need to be handled accordingly.

Once an issue is fixed by duckdb itself, all related fix code and doc should be removed.

|   #     |Fonction/Propriété                       | Actual                                             | Expected                       | Fixed|
|---------|-----------------------------------------|----------------------------------------------------|--------------------------------|-----------|
| **209** | `Relation.aggregate()` param `aggr_expr`| `Expression \| str`                                | + `Iterable[Expression \| str]`| **X**     |
| **210** | `StarExpression()` param `exclude`      | `Expression \| str \| tuple[str]`                  | `Iterable[Expression \| str]`  | **X**     |
| **260** | `Relation.dtypes` property return       | `List[str]`                                        | `list[DuckDBPyType]`           | **X**     |
| **279** | `read_csv()` param `path_or_buffer`     | `str \| bytes \| PathLike[str] \| PathLike[bytes]` | +`IO[str] \| IO[bytes]`        | **-**     |
| **314** | `.write_{csv, parquet}`                 | no kword marker after first arg                    | same as `to_{csv, parquet}`    | **X**     |  

### Manual type ignores

Some lines of code need to have manually added type ignores, because of duckdb inerhent typing issues (as detailled above, or for incompatible overrides).
Adding type programmaticaly is awkward due to auto code formatting from Ruff.

Those are:

- `Relation.aggregate()` param `aggr_expr` (rule above)
- `Relation.dtypes` return (rule above)
- `Expression.__eq__()` return (incompatible override)
- `Expression.__ne__()` return (incompatible override)
